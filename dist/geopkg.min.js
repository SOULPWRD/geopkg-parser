function j(e){return[...new Array(e)]}function F(e,t="utf-8"){return new TextDecoder(t).decode(e)}function L(e){return function(t,n){return j(e).map(function(r,a){return t.getInt8(n+a)}).reduce(function([r,a],o){return r|=o<<a,a-=8,[r,a]},[0,e*8-8])}}function q(e,t){return[e,t]}function D(e){return e.reduce(function(t,[n,r]){return t[n]=r,t},{})}function G(e=[],t=[]){let n=j(e.length);return e.length!==t.length&&(n=j(e.length<t.length?e.length:t.length)),n.map(function(r,a){return q(e[a],t[a])})}function H(e=""){let t=e.match(/\((.*)\)/);return t?t[1].split(",").map(function(n){let r=n.trim().split(" ");return{name:r[0],type:r[1]}}):[]}var i=Object.freeze({decode_text:F,from_pairs:D,from_sql:H,get_int:L,make_empty_list:j,pair:q,zip:G});function M(e,t=0){let n=0n,r=t,a;do a=e.getUint8(t),t-r<8?n=(n<<7n)+BigInt(a&127):n=(n<<8n)+BigInt(a&255),t+=1;while(a&128);return Object.freeze({data:Number(n),size:t-r})}var f=Object.freeze({decode:M});function R(e,t,n,r){return i.make_empty_list(r).map(function(a,o){return o*2}).reduce(function(a,o){let c=e.getUint16(n+o);return a.push(t+c),a},[])}function N(e,t){let n=e.getUint32(t),r=f.decode(e,t+4);return Object.freeze({left_child_page_nr:n,row_id:r.data})}function V(e,t){let n=f.decode(e,t);t+=n.size;let r=f.decode(e,t);return t+=r.size,Object.freeze({payload_end:t+n.data,payload_start:t,row_id:r.data})}function C(e,t){let n=f.decode(e,t);return t+=n.size,Object.freeze({payload_end:t+n.data,payload_start:t})}function J(e,t){let n=e.getUint32(t),r=f.decode(e,t);return t+=r.size,Object.freeze({left_child_page_nr:n,payload_end:t+r.data,payload_start:t})}var m=Object.freeze({parse_index_interior:J,parse_index_leaf:C,parse_pointers:R,parse_table_interior:N,parse_table_leaf:V});function K(e,t,n){let r=(t-12)/2;return Object.freeze({data:new Uint8Array(e.buffer,n,r),size:r})}function P(e,t,n,r="utf-8"){let a=(t-13)/2,o=new Uint8Array(e.buffer,n,a);return Object.freeze({data:i.decode_text(o,r),size:a})}function Q(e,t,n=0,r="utf-8"){return t===0?Object.freeze({data:null,size:0}):t===1?Object.freeze({data:e.getInt8(n),size:1}):t===2?Object.freeze({data:e.getInt16(n),size:2}):t===3?Object.freeze({data:i.get_int(24)(e,n),size:3}):t===4?Object.freeze({data:e.getInt32(n),size:4}):t===5?Object.freeze({data:i.get_int(48)(e,n),size:6}):t===6?Object.freeze({data:null,size:8}):t===7?Object.freeze({data:e.getFloat64(n),size:8}):t===8?Object.freeze({data:0,size:0}):t===9?Object.freeze({data:1,size:0}):t>=12?t%2===0?K(e,t,n):P(e,t,n,r):Object.freeze({data:null,size:0})}function W(e,t,n){let r=[];for(;n>0;){let a=f.decode(e,t);r.push(a.data),t+=a.size,n-=a.size}return Object.freeze({data:r,offset:t})}function X(e,t,n=0,r="utf-8"){return t.reduce(function(a,o){let c=Q(e,o,a.offset,r);return a.data.push(c.data),a.offset+=c.size,a},{data:[],offset:n})}function Y(e,t,n="utf-8"){let r=f.decode(e,t),a=r.data-r.size,o=W(e,t+r.size,a),c=X(e,o.data,o.offset,n);return Object.freeze({columns:c.data,header:r})}var O=Object.freeze({parse:Y});function B(e){return[10,13].includes(e)}function Z(e,t,n){let r=e.getUint8(t),a=e.getUint16(t+1),o=e.getUint16(t+3),c=n+e.getUint16(t+5),g=e.getUint8(t+7),u=e.getUint32(t+8);return Object.freeze({cell_content_area:c===0?65536:c,fragmented_free_bytes_nr:g,freeblock_start:a,number_of_cells:o,page_type:r,right_most_pointer:u})}function $(e,t,n){let r=t.map(function(o){return m.parse_table_leaf(e,o)}),a=r.map(function(o){return O.parse(e,o.payload_start,n)});return Object.freeze({cells:r,records:a})}function w(e,t){let n=t.map(function(r){return m.parse_table_interior(e,r)});return Object.freeze({cells:n})}function v(e,t,n){let r=t.map(function(o){return m.parse_index_leaf(e,o)}),a=r.map(function(o){return O.parse(e,o.payload_start,n)});return Object.freeze({cells:r,records:a})}function ee(e,t,n){let r=t.map(function(o){return m.parse_index_interior(e,o)}),a=r.map(function(o){return O.parse(e,o.payload_start,n)});return Object.freeze({cells:r,records:a})}function te(e,t,n){let r=t===100?0:t,a=Z(e,t,r),o=m.parse_pointers(e,r,B(a.page_type)?t+8:t+12,a.number_of_cells),c={};return a.page_type===2&&(c=ee(e,o,n)),a.page_type===5&&(c=w(e,o)),a.page_type===10&&(c=v(e,o,n)),a.page_type===13&&(c=$(e,o,n)),Object.freeze(Object.assign({header:a},c))}var h=Object.freeze({is_leaf:B,parse:te});var ne=["utf-8","utf-16le","utf-16be"];function re(e){let t=i.decode_text(new Uint8Array(e.buffer).slice(0,16)),n=e.getUint16(16),r=e.getUint8(18),a=e.getUint8(19),o=e.getUint8(20),c=e.getUint8(21),g=e.getUint8(22),u=e.getUint8(23),s=e.getUint32(24),_=e.getUint32(28),l=e.getUint32(32),p=e.getUint32(36),b=e.getUint32(40),U=e.getUint32(44),y=e.getUint32(48),d=e.getUint32(52),z=e.getUint32(56),x=e.getUint32(60),k=e.getUint32(64),A=e.getUint32(68),S=e.getUint32(92),E=e.getUint32(96);return Object.freeze({application_id:A,db_pages_count:_,db_text_encoding:z,default_page_cache_size:y,file_change_counter:s,free_list_pages_count:p,free_list_trunk_page_nr:l,header_string:t,incremental_vacuum_mode:k,largest_root_b_tree:d,leaf_payload_fraction:u,maximum_payload_fraction:c,minimum_payload_fraction:g,page_size:n,read_version:a,reserved_space:o,schema_cookie:b,schema_format_nr:U,sqlite_version:E,user_version:x,version_valid_for:S,write_version:r})}var I=Object.freeze({encodings:ne,parse:re});function ae(e){let t=I.parse(e),n=I.encodings[t.db_text_encoding-1],r=i.make_empty_list(t.db_pages_count).map(function(a,o){return o===0?h.parse(e,100,n):h.parse(e,o*t.page_size,n)});return Object.freeze({header:t,pages:r})}var T=Object.freeze(ae);var oe=["type","name","tbl_name","rootpage","sql"];function ce(e){let t=new DataView(e),n=T(t);function r(u){let s=[],_=[n.pages[u]];for(;_.length>0;){let l=_.shift();h.is_leaf(l.header.page_type)?s.push(l):l.cells.forEach(function(p){_.push(n.pages[p.left_child_page_nr-1])})}return s}function a(u=0,s=void 0){return Object.freeze({header:n.header,pages:n.pages.slice(u,s)})}function o(){return r(0).map(function(u){return u?.records.filter(function(s){return s.columns[0]==="table"}).map(function(s){let _=s.columns[s.columns.length-1],l=i.from_sql(_),p=i.zip(oe,s.columns),b=i.from_pairs(p);return Object.assign(b,{columns:l})})}).flat()}function c(){return o().filter(function(s){return s.type==="table"}).map(function(s){return{name:s.tbl_name}})}function g(u,s=0,_=void 0){let p=o()?.find(function(d){let{tbl_name:z,type:x}=d;return u===z&&x==="table"}),{columns:b,rootpage:U}=p,y=b.map(function(d){return d.name});return r(U-1).map(function(d){return d.records.map(function(z){return i.from_pairs(i.zip(y,z.columns))})}).flat().slice(s,_)}return Object.freeze({from:g,master_schema:o,parsed:a,show_tables:c})}var Be=Object.freeze(ce);export{Be as default};
